<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        /* PDF Export handles margins via QPrinter. Body margin 0. */
        body { 
            font-family: 'Arial', 'Tahoma', sans-serif; 
            font-size: 10pt; 
            color: #000; 
            background-color: #fff; 
            margin: 0;
            padding: 0;
        }
        
        h1 { font-size: 18pt; font-weight: bold; margin: 0 0 5px 0; text-transform: uppercase;}
        
        /* Helper classes for styling content INSIDE tables */
        .header-content { margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; }
        
        .invoice-info-item { margin-bottom: 3px; }
        .invoice-info-label { font-weight: bold; margin-right: 5px; }

        /* KSeF Styles */
        .ksef-box {
            margin-bottom: 20px;
            border: 2px solid #004d00;
            background-color: #e8f5e9;
        }
        .ksef-title {
            background-color: #c8e6c9;
            color: #004d00;
            font-weight: bold;
            padding: 5px 10px;
            border-bottom: 1px solid #004d00;
        }
        .ksef-content { padding: 0 5px 5px 5px; font-size: 9pt; }
        .ksef-layout-table td { background-color: #e8f5e9; } /* Ensure rows get the color */

        /* Parties Styles */
        .parties-container { 
            width: 100%; 
            margin-bottom: 20px; 
            border: 1px solid #000;
        }
        .party-header { 
            font-weight: bold; 
            background-color: #eee; 
            padding: 5px; 
            border-bottom: 1px solid #000; 
            text-align: center; 
        }
        .party-content {
            padding: 10px;
            vertical-align: top;
            background-color: #ffffff; /* Explicit white background */
        }

        /* Items Table */
        .items-table { margin-top: 20px; margin-bottom: 20px; border: 1px solid #000; border-collapse: collapse; width: 100%; }
        .items-table th { 
            border: 1px solid #000; 
            background-color: #eee; 
            font-weight: bold; 
            font-size: 8pt; 
            padding: 4px;
            text-align: center;
        }
        .items-table td { 
            border: 1px solid #000; 
            padding: 4px; 
            font-size: 9pt;
            vertical-align: top;
        }
        .items-table .num-col { text-align: right; white-space: nowrap; }
        .items-table .center-col { text-align: center; }
        .desc-row td { border-top: none; font-style: italic; font-size: 8pt; color: #444; padding-left: 20px; }
        
        /* Totals Layout */
        .totals-table { width: 100%; border-collapse: collapse; border: 1px solid #000; }
        .totals-table th { background-color: #eee; border: 1px solid #000; font-size: 9pt; padding: 3px; }
        .totals-table td { border: 1px solid #000; text-align: right; padding: 3px; font-size: 9pt; }

        /* Payment */
        .payment-section { border-top: 2px solid #000; padding-top: 10px; margin-top: 20px; }

        /* Footer */
        .footer { margin-top: 30px; font-size: 8pt; text-align: center; color: #555; border-top: 1px solid #ccc; padding-top: 5px; }
        
        /* New Page for Annotations */
        .page-break { page-break-before: always; border-top: 1px dashed #ccc; margin-top: 20px; padding-top: 20px; }
        
        .annotations-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; border: 1px solid #000; }
        .annotations-table th { background-color: #eee; border: 1px solid #000; padding: 5px; font-size: 9pt; text-align: center; }
        .annotations-table td { border: 1px solid #000; padding: 5px; font-size: 9pt; text-align: center; }
        
        .annotations-list ul { list-style-type: none; padding: 0; margin: 0; }
        .annotations-list li { margin-bottom: 5px; font-size: 9pt; }
        
        .registers-table { width: 100%; border-collapse: collapse; border: 1px solid #000; margin-top: 20px; }
        .registers-table th { background-color: #eee; border: 1px solid #000; padding: 5px; font-size: 9pt; text-align: left; }
        .registers-table td { border: 1px solid #000; padding: 5px; font-size: 9pt; }
        
    </style>
</head>
<body>
    
    <!-- 1. Header Section (HTML Table for layout robustness) -->
    <div class="header-content">
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td width="60%" valign="top" align="left">
                    <h1>${inv_type_label}</h1>
                    <span style='font-size: 16pt; font-weight: bold;'>nr ${inv_number}</span>
                    <div style='margin-top: 5px; font-size: 10pt;'>${method_label}</div>
                </td>
                <td width="40%" valign="top" align="right">
                     <table width="100%" align="right">
                         ${invoice_dates_table}
                     </table>
                </td>
            </tr>
        </table>
    </div>

    <!-- 2. KSeF Info -->
    ${ksef_block}

    <!-- 3. Parties (HTML Table for layout robustness) -->
    <!-- Border 1px solid handled by wrapper table style or class -->
    <table class="parties-container" cellspacing="0" cellpadding="0">
        <tr>
            <!-- Left Column: Seller -->
            <td width="50%" valign="top" style="border-right: 1px solid #000;">
                <div class="party-header">SPRZEDAWCA</div>
                <div class="party-content">${seller_content}</div>
            </td>
            <!-- Right Column: Buyer -->
            <td width="50%" valign="top">
                <div class="party-header">NABYWCA</div>
                <div class="party-content" style="text-align: right;">${buyer_content}</div>
            </td>
        </tr>
    </table>

    <!-- 4. Items Table (Table is best for items) -->
    <table class='items-table'>
        <thead>
            <tr>
                <th width="5%">Lp</th>
                <th width="30%">Nazwa towaru / usługi</th>
                <th width="8%">Ilość</th>
                <th width="6%">J.m.</th>
                <th width="10%">Cena netto</th>
                <th width="10%">Wartość netto</th>
                <th width="6%">Stawka VAT</th>
                <th width="10%">Kwota VAT</th>
                <th width="15%">Wartość brutto</th>
            </tr>
        </thead>
        <tbody>
            ${items_rows}
        </tbody>
    </table>

    <!-- 5. Totals & Signature (Layout Table) -->
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
            <td width="55%" valign="top">
                 <div style='font-size: 14pt; font-weight: bold; margin-bottom: 5px;'>
                    DO ZAPŁATY: ${total_gross_display}
                 </div>
                 <div style='font-size: 10pt;'>
                    Słownie: (kwota numerycznie)
                 </div>
            </td>
            <td width="45%" valign="top">
                <table class='totals-table'>
                    <tr>
                        <th>Stawka</th>
                        <th>Netto</th>
                        <th>VAT</th>
                        <th>Brutto</th>
                    </tr>
                    ${vat_rows}
                </table>
            </td>
        </tr>
    </table>

    <!-- 6. Payment & Notes -->
    ${payment_block}

    <!-- 7. Footer -->
    ${footer_block}

    <!-- 8. Annotations Page -->
    ${annotations_page}

</body>
</html>